<!DOCTYPE html>
<meta charset="utf-8">
  <head>

    <link rel="stylesheet" type="text/css" href="src/styles.css">

    <script src="lib/jquery-1.11.0/jquery-1.11.0.min.js" charset="utf-8"></script>
    <script src="lib/d3-3.4.4/d3.min.js"></script>
    <script src="lib/crossfilter/crossfilter.min.js" charset="utf-8"></script>
    <script src="lib/dc-1.6.0/dc.min.js" charset="utf-8"></script>
    <!--<script src="http://cdnjs.cloudflare.com/ajax/libs/dc/1.6.0/dc.min.js" charset="utf-8"></script>-->

  </head>
    <body>

        <div class="content">
            <div class="container">

                <div class="row">
                    <div class="span6" id="dc-day-chart">
                        <h4>Daily Expenses</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="span4" id="dc-month-chart">
                        <h4>Monthly Expenses</h4>
                    </div>
                    <div class="span4" id="dc-detail-chart">
                        <h4>Expense by Location</h4>
                    </div>
                    <div class="span4" id="dc-name-chart">
                        <h4>Expense by user</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="span12" id="table-chart">
                        <table class="table table-hover" id="dc-table-graph">
                            <thead>
                                <tr class="header">
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Detail</th>
                                    <th>Who</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>

            </div>
        </div>

    <script>
        var
          dayChart
        , monthChart
        , nameChart
        , dataTable
        , detailChart

        , dtgFormat2
        , monthNames
        , parseDate
        ;

        //Utilities
        parseDate = d3.time.format("%Y-%b-%d");
        monthNames = [ "jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec" ];

        /* plots dc-2.0.0 charts */
        function generate(data) {
            var
            facts
            , dayDimension
            , dayDimensionGroup

            , margins_template
            , span_height
            , span4_width
            , span6_width
            , span12_width

            , start_dayChart
            , end_dayChart
            , start_monthChart
            , end_monthChart
            ;

            //formatting and utilities
            margins_template = {top: 10, right: 10, bottom: 80, left: 60};
            span_height = 350;
            span4_width = 250;
            span6_width = 400;
            span12_width = 700;

            data.forEach(function(d) {
                d.date = parseDate.parse(d.date);
                d.month = d3.time.month(d.date);
                d.year = d.date.getFullYear().toString();
                d._month = monthNames[d.date.getMonth()];
                d.day = d.date.getDate().toString();
                d.amount = +d.amount.toFixed(2);
            });

            // Run the data through crossfilter and load our 'facts'
            facts = crossfilter(data);

            // Create crossfilter dimensions
            dayDimension = facts.dimension(function(d) { return d3.time.day(d.date); });
            dayDimensionGroup = dayDimension.group().reduceSum(function(d) { return d.amount; });

            //// Receipts by day
            start_dayChart = d3.time.day.offset(d3.extent(data, function(d){ return d.date; })[0], -1);
            end_dayChart  = d3.time.day.offset(d3.extent(data, function(d){ return d.date; })[1], +1);
            dayChart.width(span12_width)
                    .height(span_height)
                    .margins(margins_template)
                    .dimension(dayDimension)
                    .group(dayDimensionGroup)
                    .title("Daily Expenses")
                    .transitionDuration(500)
                    .centerBar(true)
                    .gap(1)
                    .xUnits(d3.time.days)
                    .x(d3.time.scale().domain([start_dayChart, end_dayChart]) )
                    .elasticY(true)
                    .xAxis();

            // Table of receipt data
            dataTable.width( span12_width )
                    .dimension( dayDimension )
                    .group(function() {
                      return "";
                    })
                    .size(10).order(d3.descending)
                    .columns([
                      function(d) { return d.date.toDateString(); },
                      function(d) { return d.amount; },
                      function(d) { return d.detail; },
                      function(d) { return d.name; },
                    ]);


            // Render the Charts
            dc.renderAll();

            // Adjust axes
            d3.select("#dc-day-chart .axis.x")
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-.8em")
                    .attr("dy", ".15em")
                    .attr("transform", function() {
                      return "rotate(-45)";
                    });

        }

        function init() {

            // Create the dc-2.0.0 chart objects & link to div
            dayChart = dc.barChart("#dc-day-chart");
            dataTable = dc.dataTable("#dc-table-graph");

            var data =  [{"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 55.67, "date": "2014-Jan-21", "pk": 41}, {"name": "arw", "detail": "Metro", "created_by": "burOak", "amount": 90.73, "date": "2014-Jan-18", "pk": 40}, {"name": "jvw", "detail": "No Frills", "created_by": "burOak", "amount": 5.26, "date": "2014-Jan-14", "pk": 39}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 57.54, "date": "2014-Jan-14", "pk": 38}, {"name": "arw", "detail": "Garden Basket", "created_by": "burOak", "amount": 35.54, "date": "2014-Jan-04", "pk": 36}, {"name": "arw", "detail": "Garden Basket", "created_by": "burOak", "amount": 26.02, "date": "2014-Jan-09", "pk": 35}, {"name": "jvw", "detail": "Longos", "created_by": "burOak", "amount": 55.93, "date": "2014-Jan-07", "pk": 34}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 31.29, "date": "2014-Jan-09", "pk": 33}, {"name": "jvw", "detail": "Shoppers Drug Mart", "created_by": "burOak", "amount": 23.9, "date": "2014-Jan-06", "pk": 32}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 17.94, "date": "2013-Dec-31", "pk": 31}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 95.1, "date": "2013-Dec-29", "pk": 30}, {"name": "arw", "detail": "Whole Foods", "created_by": "burOak", "amount": 36.03, "date": "2013-Dec-19", "pk": 29}, {"name": "arw", "detail": "Loblaws", "created_by": "burOak", "amount": 45.2, "date": "2013-Dec-27", "pk": 28}, {"name": "arw", "detail": "Garden Basket", "created_by": "burOak", "amount": 65.39, "date": "2013-Dec-22", "pk": 27}, {"name": "arw", "detail": "Shoppers Drug Mart", "created_by": "burOak", "amount": 10.49, "date": "2013-Dec-22", "pk": 26}, {"name": "jvw", "detail": "Longos", "created_by": "burOak", "amount": 42.48, "date": "2013-Dec-24", "pk": 25}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 51.81, "date": "2013-Dec-16", "pk": 24}, {"name": "arw", "detail": "Canadian Tire", "created_by": "burOak", "amount": 18.0, "date": "2013-Dec-14", "pk": 23}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 40.07, "date": "2013-Dec-13", "pk": 22}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 42.6, "date": "2013-Dec-13", "pk": 21}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 18.59, "date": "2013-Dec-12", "pk": 20}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 29.93, "date": "2013-Dec-07", "pk": 19}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 40.07, "date": "2013-Dec-06", "pk": 18}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 46.32, "date": "2013-Dec-09", "pk": 17}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 40.41, "date": "2013-Dec-05", "pk": 16}, {"name": "arw", "detail": "Garden Basket", "created_by": "burOak", "amount": 93.64, "date": "2013-Dec-02", "pk": 15}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 27.82, "date": "2013-Dec-03", "pk": 14}, {"name": "jvw", "detail": "Longos", "created_by": "burOak", "amount": 51.86, "date": "2013-Nov-19", "pk": 13}, {"name": "arw", "detail": "Garden Basket", "created_by": "burOak", "amount": 32.35, "date": "2013-Nov-14", "pk": 12}, {"name": "arw", "detail": "Whole Foods", "created_by": "burOak", "amount": 50.12, "date": "2013-Nov-13", "pk": 11}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 65.12, "date": "2013-Nov-04", "pk": 10}, {"name": "arw", "detail": "Garden Basket", "created_by": "burOak", "amount": 20.35, "date": "2013-Oct-27", "pk": 9}, {"name": "arw", "detail": "Longos", "created_by": "burOak", "amount": 27.76, "date": "2013-Oct-28", "pk": 8}, {"name": "jvw", "detail": "Longos", "created_by": "burOak", "amount": 59.81, "date": "2013-Nov-11", "pk": 7}, {"name": "jvw", "detail": "Shoppers Drug Mart", "created_by": "burOak", "amount": 33.83, "date": "2013-Nov-07", "pk": 6}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 48.39, "date": "2013-Nov-04", "pk": 5}, {"name": "jvw", "detail": "Longos", "created_by": "burOak", "amount": 85.57, "date": "2013-Oct-30", "pk": 4}, {"name": "jvw", "detail": "Shoppers Drug Mart", "created_by": "burOak", "amount": 15.33, "date": "2013-Oct-27", "pk": 3}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 64.44, "date": "2013-Oct-26", "pk": 2}, {"name": "jvw", "detail": "Garden Basket", "created_by": "burOak", "amount": 53.28, "date": "2013-Oct-23", "pk": 1}];

            generate(data);

        }

        init();

    </script>

    </body>
</html>
