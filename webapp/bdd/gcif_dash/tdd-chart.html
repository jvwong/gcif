<!DOCTYPE html>
<meta charset="utf-8">
    <head>

        <link rel="stylesheet" type="text/css" href="src/styles.css">
        <link rel="stylesheet" type="text/css" href="src/custom.css">

        <script src="lib/jquery-1.11.0/jquery-1.11.0.min.js" charset="utf-8"></script>
        <script src="lib/d3-3.4.4/d3.min.js"></script>
        <script src="lib/crossfilter/crossfilter.min.js" charset="utf-8"></script>
        <script src="lib/dc-1.6.0/dc.min.js" charset="utf-8"></script>
        <!--<script src="http://cdnjs.cloudflare.com/ajax/libs/dc/1.6.0/dc.min.js" charset="utf-8"></script>-->

        <!--gcif javascript-->
        <script src="src/gcif.js" charset="utf-8"></script>
        <script src="src/gcif.util.js" charset="utf-8"></script>
        <script src="src/gcif.shell.js" charset="utf-8"></script>

        <script>
            $(function () { gcif.initModule( $('#dash') ); });
        </script>

    </head>
    <body>

        <div id="dash"></div>

        <script>
            var
              dayChart
            , dataTable

            , dtgFormat2
            , monthNames
            , parseDate
            ;


            /* plots dc-2.0.0 charts */
            function generate(data) {

                var
                  facts

                , dayDimension
                , dayDimensionGroup

                , margins_template

                , span_height
                , span4_width
                , span6_width
                , span12_width

                , nestByCity

                , start_dayChart
                , end_dayChart

                ;

                //formatting and utilities
                margins_template = {top: 10, right: 10, bottom: 80, left: 60};
                span_height = 350;
                span4_width = 250;
                span6_width = 400;
                span12_width = 700;



                // data variable formatting

                // A nest operator, for grouping the flight list.
                nestByCity = d3.nest().key(function(data) { return d3.time.day(d.date); });

                data.forEach(function(d) {

                    if( (d["CityName"]).toUpperCase() === "TORONTO"){
                        gcif.util.parseData(d);
                        console.log(d);
                    }


    //                d.date = parseDate.parse(d.date);
    //                d.month = d3.time.month(d.date);
    //                d.year = d.date.getFullYear().toString();
    //                d._month = monthNames[d.date.getMonth()];
    //                d.day = d.date.getDate().toString();
    //                d.amount = +d.amount.toFixed(2);

    //                console.log(d);
                });



    //            // Run the data through crossfilter and load our 'facts'
    //            facts = crossfilter(data);
    //
    //            // Create crossfilter dimensions
    //            dayDimension = facts.dimension(function(d) { return d3.time.day(d.date); });
    //            dayDimensionGroup = dayDimension.group().reduceSum(function(d) { return d.amount; });
    //
    //            //// Receipts by day
    //            start_dayChart = d3.time.day.offset(d3.extent(data, function(d){ return d.date; })[0], -1);
    //            end_dayChart  = d3.time.day.offset(d3.extent(data, function(d){ return d.date; })[1], +1);
    //            dayChart.width(span12_width)
    //                    .height(span_height)
    //                    .margins(margins_template)
    //                    .dimension(dayDimension)
    //                    .group(dayDimensionGroup)
    //                    .title("Daily Expenses")
    //                    .transitionDuration(500)
    //                    .centerBar(true)
    //                    .gap(1)
    //                    .xUnits(d3.time.days)
    //                    .x(d3.time.scale().domain([start_dayChart, end_dayChart]) )
    //                    .elasticY(true)
    //                    .xAxis();
    //
    //            // Table of receipt data
    //            dataTable.width( span12_width )
    //                    .dimension( dayDimension )
    //                    .group(function() {
    //                      return "";
    //                    })
    //                    .size(10).order(d3.descending)
    //                    .columns([
    //                      function(d) { return d.date.toDateString(); },
    //                      function(d) { return d.amount; },
    //                      function(d) { return d.detail; },
    //                      function(d) { return d.name; },
    //                    ]);
    //
    //
    //            // Render the Charts
    //            dc.renderAll();
    //
    //            // Adjust axes
    //            d3.select("#dc-day-chart .axis.x")
    //                    .selectAll("text")
    //                    .style("text-anchor", "end")
    //                    .attr("dx", "-.8em")
    //                    .attr("dy", ".15em")
    //                    .attr("transform", function() {
    //                      return "rotate(-45)";
    //                    });

            }

            function init() {

                // Create the dc-2.0.0 chart objects & link to div
                dayChart = dc.barChart("#dc-barChart-population");
                dataTable = dc.dataTable("#dc-dataTable-data");

                var dataPath = "src/clean_compile.csv"
                d3.csv(dataPath, function(error, rawData) {

                    if (error){
                        console.log("error: %s", error);
                    }else{
                        generate(rawData);
                    }

                });

            }

            init();

        </script>

    </body>
</html>

